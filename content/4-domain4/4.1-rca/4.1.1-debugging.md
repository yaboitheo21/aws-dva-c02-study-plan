---
title: "4.1.1-4.1.7 Debugging, Logs, Traces"
date: 2025-02-11
weight: 1
---

## CloudWatch

### Metrics quan trọng

| Service | Key Metrics |
|---------|------------|
| Lambda | Invocations, Duration, Errors, Throttles, ConcurrentExecutions |
| API Gateway | Count, Latency, 4XXError, 5XXError |
| DynamoDB | ConsumedRCU, ConsumedWCU, ThrottledRequests |
| SQS | NumberOfMessagesSent, ApproximateAgeOfOldestMessage |

### Logs Insights Query Examples
```sql
-- Find errors
fields @timestamp, @message
| filter @message like /ERROR/
| sort @timestamp desc
| limit 20

-- P99 latency
stats pct(@duration, 99) as p99 by bin(1h)

-- Cold starts
filter @message like /Init Duration/
| stats count(*) as coldStarts by bin(5m)
```

### Embedded Metric Format (EMF)
- Emit custom metrics từ application logs
- Structured JSON → auto-extracted as CloudWatch metrics
- No PutMetricData API calls needed = no extra cost

## X-Ray

### Concepts

| Concept | Mô tả |
|---------|--------|
| Trace | End-to-end request path |
| Segment | Data from one service |
| Subsegment | Detailed breakdown |
| Annotation | Key-value, **indexed** (searchable) |
| Metadata | Key-value, **not indexed** |
| Service Map | Visual dependency graph |

### Common Integration Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| Lambda timeout | Function > 15min or API GW > 29s | Optimize code, async |
| Lambda no internet | In VPC without NAT | NAT Gateway or VPC Endpoint |
| DynamoDB throttling | Hot partition or low capacity | Better key design, increase capacity |
| SQS reprocessing | Visibility timeout < function timeout | Increase visibility timeout |

{{% notice tip %}}
**Exam Tip:** X-Ray Annotations = searchable (dùng cho filtering). Metadata = not searchable (dùng cho detailed data).
{{% /notice %}}
