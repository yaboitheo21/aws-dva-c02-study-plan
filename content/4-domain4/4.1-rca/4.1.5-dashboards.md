---
title: "4.1.5 Review Health with Dashboards & Insights"
date: 2025-02-11
weight: 5
---

## Review Application Health

### CloudWatch Dashboards

- Custom dashboards với metrics, logs, alarms
- **Cross-account, cross-region** dashboards
- Auto-refresh intervals
- Share via URL (public or authenticated)
- **Single shared dashboard** để monitor nhiều applications

### Key Widgets

| Widget | Use Case |
|--------|----------|
| Line graph | Metrics over time (latency, errors) |
| Number | Current value (active connections) |
| Alarm status | Health overview |
| Log insights | Recent errors, patterns |
| Explorer | Dynamic resource discovery |

### CloudWatch ServiceLens

**Amazon CloudWatch ServiceLens** là tính năng trong CloudWatch giúp giám sát, chẩn đoán và phân tích ứng dụng phân tán bằng cách **tập hợp metrics, logs và traces** trong một giao diện duy nhất.

#### 3 Pillars of Observability

ServiceLens tích hợp:

```text
1. Metrics → Chỉ số hoạt động (latency, error rate)
2. Logs → Nhật ký ứng dụng, hệ thống
3. Traces → X-Ray traces theo dõi luồng request
```

#### Mục tiêu chính

**a) Hiểu toàn bộ hệ thống**
- Nhìn đầy đủ: User → Application → Backend → Database
- Thay vì rải rác theo từng silo dữ liệu

**b) Service Map**
- Hiển thị bản đồ dịch vụ với nodes (resources) và edges (dependencies)
- Cho thấy cách request di chuyển qua các components

```text
Example Service Map:
User → API Gateway → Lambda → DynamoDB
                            → SQS → Lambda Worker
```

**c) Tăng tốc Root Cause Analysis**

Khi có vấn đề (latency tăng, error spike, timeout):
- ✅ Xem **trace** để biết segment nào chậm
- ✅ Xem **logs** để biết lỗi gì xảy ra
- ✅ Xem **metrics** để biết thay đổi bất thường
- ✅ Tất cả trong **cùng một view**

#### 3 Góc nhìn cốt lõi

| Góc nhìn | Mô tả |
|----------|-------|
| **Infrastructure Monitoring** | Xem metrics & logs để hiểu resources (EC2, Lambda, database) |
| **Transaction Monitoring** | Xem traces để hiểu request flow qua các components |
| **End-User Monitoring** | Tích hợp Synthetics canaries để theo dõi user experience |

#### Service Map Features

```text
Service Map hiển thị:
- Nodes: Services/Resources (Lambda, API Gateway, DynamoDB)
- Edges: Dependencies và request flow
- Health indicators: Green (OK), Yellow (warnings), Red (errors)
- Latency per service
- Error rates per node
- Request volume
```

#### Trace Details với Correlated Metrics

```text
Khi click vào trace:
1. Request timeline
2. Subsegments breakdown
3. Correlated CloudWatch metrics
4. Related logs
5. Annotations và metadata
```

#### Lợi ích chính

| Lợi ích | Chi tiết |
|---------|----------|
| **Holistic Observability** | Không phải lật giữa metrics, logs, traces ở các tab khác nhau |
| **Tăng tốc phân tích** | Giảm thời gian tìm root cause, xác định phần bị lỗi nhanh hơn |
| **Xác định tác động user** | Xem ai bị ảnh hưởng và phần nào gây ra issue |
| **Miễn phí** | ServiceLens miễn phí, chỉ trả phí X-Ray traces, logs, metrics |

#### Quan hệ với các dịch vụ AWS

| Dịch vụ | Mối liên hệ |
|---------|-------------|
| **AWS X-Ray** | Cung cấp trace data để hiển thị trong ServiceLens |
| **CloudWatch Logs** | Chứa logs phục vụ điều tra lỗi |
| **CloudWatch Metrics** | Hiển thị metrics và alarms |
| **CloudWatch Synthetics** | Theo dõi endpoint từ phía user, hiển thị anomalies |

#### Khi nào dùng ServiceLens?

✅ **Ứng dụng microservices phân tán**
✅ **Môi trường serverless** (Lambda, Fargate)
✅ **Hệ thống phức tạp** với nhiều dịch vụ liên kết
✅ **DevOps/SRE teams** muốn observability sâu

#### Setup Requirements

```text
1. Enable X-Ray tracing:
   - Lambda: Tracing: Active
   - API Gateway: Stage settings
   - ECS: X-Ray daemon sidecar

2. Instrument application:
   - Use X-Ray SDK
   - patch_all() for auto-instrumentation

3. CloudWatch Logs:
   - Ensure logs are sent to CloudWatch

4. Access ServiceLens:
   - CloudWatch Console → ServiceLens
```

#### Example: Troubleshooting với ServiceLens

**Scenario**: API latency tăng đột ngột

```text
1. Service Map:
   - Thấy Lambda node màu vàng (warnings)
   - Latency tăng từ 100ms → 2000ms

2. Click vào Lambda node:
   - Xem traces: 95% requests chậm ở DynamoDB call
   
3. Correlated metrics:
   - DynamoDB ThrottledRequests tăng
   
4. Related logs:
   - "ProvisionedThroughputExceededException"
   
5. Root cause: Hot partition trong DynamoDB
6. Solution: Better partition key design hoặc on-demand billing
```

### CloudWatch Synthetics

**Amazon CloudWatch Synthetics** là dịch vụ AWS cho phép giám sát liên tục endpoints và APIs bằng **canaries** – scripts nhẹ chạy định kỳ để kiểm tra availability, latency, và user experience từ "ngoài vào".

#### Canaries là gì?

**Canary** = script monitoring chạy theo schedule để:
- Kiểm tra tính sẵn sàng (availability) của endpoints
- Đo độ trễ (latency)
- Thu thập screenshots (visual monitoring)
- Phát hiện issues **trước khi users gặp**
- Chạy 24/7 theo lịch (ví dụ: mỗi phút)

#### Dữ liệu thu thập

| Data Type | Mô tả |
|-----------|-------|
| **Load time** | Thời gian tải trang/API |
| **Screenshots** | Visual monitoring, so sánh UI changes |
| **Logs** | Chi tiết execution logs |
| **Metrics** | SuccessPercent, Duration, Failed |

#### Tích hợp với ServiceLens

Kết quả phân tích tích hợp với **CloudWatch ServiceLens** để:
- Theo dõi end-to-end application
- Phân tích root cause analysis
- Correlate với X-Ray traces
- Debug anomalies trong distributed systems

#### Canary Types

| Type | Use Case |
|------|----------|
| **Heartbeat** | Monitor endpoint availability |
| **API Canary** | Test REST APIs |
| **Broken Link Checker** | Find broken links on website |
| **Visual Monitoring** | Detect UI changes |
| **Canary Recorder** | Record user actions, replay |

#### Example: Create Canary

```python
import boto3

client = boto3.client('synthetics')

response = client.create_canary(
    Name='api-health-check',
    Code={
        'Handler': 'apiCanaryBlueprint.handler',
        'S3Bucket': 'my-canary-scripts',
        'S3Key': 'canary.zip'
    },
    ArtifactS3Location='s3://my-canary-results/',
    ExecutionRoleArn='arn:aws:iam::123456789012:role/CanaryRole',
    Schedule={
        'Expression': 'rate(5 minutes)',  # Chạy mỗi 5 phút
        'DurationInSeconds': 0  # Chạy indefinitely
    },
    RuntimeVersion='syn-python-selenium-1.3',
    SuccessRetentionPeriodInDays=31,
    FailureRetentionPeriodInDays=31
)
```

#### Common API Actions

| API | Purpose |
|-----|----------|
| `CreateCanary` | Tạo canary monitoring |
| `DeleteCanary` | Xóa canary |
| `DescribeCanaries` | Xem danh sách canaries |
| `GetCanaryRuns` | Xem kết quả chạy |
| `StartCanary` / `StopCanary` | Start/stop canary |
| `DescribeRuntimeVersions` | Xem runtime versions available |
| `TagResource` | Quản lý tags |

#### Security Considerations

- Canaries chạy trong **VPC** hoặc public internet
- Cần **IAM role** với permissions:
  - CloudWatch Logs write
  - S3 write (artifacts)
  - X-Ray write (nếu tracing enabled)
- **Secrets** nên store trong Secrets Manager, không hardcode
- Screenshots có thể chứa sensitive data

#### Metrics & Alarms

```text
Metrics:
- SuccessPercent (0-100%)
- Duration (milliseconds)
- Failed (count)
- 2xx, 4xx, 5xx (HTTP status counts)

Alarms:
- SuccessPercent < 90% → SNS alert
- Duration > 5000ms → Performance degradation
```

#### Use Cases

1. **Proactive Monitoring** - Phát hiện downtime trước users
2. **API Testing** - Continuous API health checks
3. **Visual Regression** - Detect UI changes
4. **Multi-region Monitoring** - Test from different regions
5. **Post-deployment Validation** - Verify deployment success

### Lambda Insights

- Enhanced monitoring cho Lambda
- Metrics: CPU, memory, network, cold starts
- Requires Lambda Insights extension (Layer)
- Dashboard: `/aws/lambda-insights/`

### Container Insights

- ECS/EKS monitoring
- Metrics: CPU, memory, network, disk per task/pod
- Performance log events
- Automatic dashboards

### Application Insights

- Automatic problem detection
- .NET, Java, SQL Server workloads
- Correlate metrics, logs, alarms
- Automated dashboards

### VPC Flow Logs

- Monitor network traffic trong VPC
- Troubleshoot connectivity issues
- Security analysis
- Publish to CloudWatch Logs hoặc S3

## Visualization Services

### Amazon Managed Grafana

- Visualize data từ multiple sources
- CloudWatch, Prometheus, OpenSearch, Timestream
- Custom dashboards và alerts

### Amazon OpenSearch

- Log analytics và visualization
- Kibana dashboards
- Full-text search
- Real-time analysis

{{% notice tip %}}
**Exam Tip:** 
- **Lambda Insights** = enhanced Lambda monitoring (add as Layer)
- **Container Insights** = ECS/EKS monitoring
- **ServiceLens** = end-to-end application view
- **Synthetics** = proactive API endpoint monitoring
- **VPC Flow Logs** = network troubleshooting
- CloudWatch Dashboards cho custom views, có thể cross-account/cross-region
{{% /notice %}}
