---
title: "4.1.6 Troubleshoot Deployment Failures"
date: 2025-02-11
weight: 6
---

## Troubleshoot Deployment Failures

### Where to Find Logs

| Service | Log Location |
|---------|-------------|
| CloudFormation | Stack events (Console/CLI) |
| CodeBuild | Build logs (CloudWatch Logs) |
| CodeDeploy | Deployment logs, lifecycle events |
| Elastic Beanstalk | `/var/log/`, eb logs |
| ECS | Task stopped reason, container logs |
| Lambda | CloudWatch Logs `/aws/lambda/` |

### CloudFormation Failures

| Error | Cause | Solution |
|-------|-------|----------|
| CREATE_FAILED | Resource creation error | Check stack events for specific error |
| UPDATE_ROLLBACK_FAILED | Rollback stuck | `continue-update-rollback --resources-to-skip` |
| DELETE_FAILED | Resource can't be deleted | Manual cleanup, retry |
| ROLLBACK_COMPLETE | Create failed, rolled back | Fix template, create new stack |

### CodeDeploy Failures

| Error | Cause | Solution |
|-------|-------|----------|
| Hook failed | Script error in lifecycle hook | Check hook script logs |
| Health check failed | App not responding | Check app logs, health endpoint |
| AllowTraffic failed | Target group unhealthy | Check ALB health check settings |
| Timeout | Hook exceeded timeout | Increase timeout or optimize script |
| BeforeBlockTraffic failed | Lifecycle hook script error | Check script logs |

### CodeDeploy Scenarios

**Scenario 1**: CodeDeploy agent failed to start on-premises
- Check CodeDeploy deployment details
- Verify agent installation và configuration
- Check agent logs: `/var/log/aws/codedeploy-agent/`

**Scenario 2**: Newly tagged instance trong deployment group
- CodeDeploy **không tự động deploy** lên newly tagged instance
- Phải **create new deployment** trong deployment group

**Scenario 3**: Lambda deployment failure
- Check alias configuration
- Verify alias references correct function versions
- Check IAM permissions cho CodeDeploy

### Elastic Beanstalk

**Scenario**: X-Ray tracing cho Beanstalk application
- Beanstalk environment provides **configuration option**
- Once enabled, runs X-Ray daemon **automatically**
- Không cần manual installation

```bash
# View recent logs
eb logs

# View specific log file
eb logs --log-group /aws/elasticbeanstalk/my-env/var/log/web.stdout.log
```

### ECS Task Failures

```text
Stopped reason: "Essential container in task exited"
Exit code: 137 → Out of memory (OOM killed)
Exit code: 1 → Application error
Exit code: 143 → SIGTERM (graceful shutdown)
```

### Lambda Deployment Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| Alias pointing to wrong version | Misconfigured alias | Update alias to correct version |
| Deployment package too large | Package > 50MB (direct) or 250MB (S3) | Optimize dependencies, use layers |
| Environment variable error | Missing or wrong env vars | Check Lambda configuration |

## Best Practices

1. **Always check service output logs** first
2. **CloudFormation** → stack events cho detailed error messages
3. **CodeDeploy** → lifecycle event logs cho hook failures
4. **ECS** → exit codes cho container failures
5. **Beanstalk** → `eb logs` cho application logs

{{% notice tip %}}
**Exam Tip:** 
- CloudFormation → stack events
- CodeDeploy → lifecycle event logs, newly tagged instances cần new deployment
- ECS exit code 137 = OOM
- Beanstalk → `eb logs`, X-Ray daemon auto-runs khi enabled
- Lambda alias có thể reference 2 versions khác nhau (weighted alias)
- Always check specific error message trong stack events
{{% /notice %}}
