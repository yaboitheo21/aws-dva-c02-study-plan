---
title: "4.3.5 Cache Content Based on Request Headers"
date: 2025-02-11
weight: 5
---

## Cache Content Based on Request Headers

### CloudFront Caching

**What AWS service helps optimize availability and caching?**

**CloudFront** có thể cache content based on request headers để **separate versions** của specified object based on header values trong viewer request.

### CloudFront Cache Key

| Component | Include? | Effect |
|-----------|---------|--------|
| URL path | Always | Base cache key |
| Query strings | Configurable | More = lower hit ratio |
| Headers | Configurable | More = lower hit ratio |
| Cookies | Configurable | More = lower hit ratio |

### Cache Policies

| Policy | Mô tả |
|--------|-------|
| CachingOptimized | Minimal cache key = best hit ratio |
| CachingDisabled | No caching |
| Custom | Select specific headers/query strings |

### Header-Based Caching

```text
Cache-Control: max-age=3600
→ CloudFront caches for 1 hour

Vary: Accept-Encoding
→ Separate cache entries per encoding (gzip, br)

Vary: Accept-Language
→ Separate cache entries per language
```

**Use case**: Serve different versions based on:
- Device type (mobile vs desktop)
- Language preference
- Encoding support
- Geographic location

### API Gateway Caching

- Stage-level, TTL 0-3600s (default 300s)
- Cache capacity: 0.5GB → 237GB
- Cache key: Query strings, headers
- Invalidation: `Cache-Control: max-age=0`

{{% notice tip %}}
**Exam Tip:** 
- **CloudFront** cache content based on request headers
- More items in cache key = lower hit ratio
- CachingOptimized = best performance
- API Gateway cache = stage-level
- Invalidation requires authorization
{{% /notice %}}
