---
title: "1.3.1 High-Cardinality Partition Keys"
date: 2025-02-11
weight: 1
---

## High-Cardinality Partition Keys

### Partition Key là gì?

Partition key quyết định **data distribution** trên các storage partitions của DynamoDB. Hash function áp dụng lên partition key để xác định partition lưu trữ item.

### High Cardinality = Balanced Distribution

| Cardinality | Ví dụ | Kết quả |
|-------------|-------|---------|
| ✅ Cao | `user_id`, `order_id`, `session_id` | Data phân bố đều |
| ❌ Thấp | `status` ("active"/"inactive"), `date` | Hot partition |

### Hot Partition Problem

```text
Partition A: [status=active]  → 90% traffic  ← THROTTLED
Partition B: [status=inactive] → 10% traffic ← Under-utilized
```

- Dù tổng capacity đủ, hot partition vẫn bị throttling
- **Adaptive Capacity** tự động redistribute nhưng không thay thế good key design

### Composite Key Strategies

| Strategy | Ví dụ | Use Case |
|----------|-------|----------|
| Natural high-cardinality | `user_id` | User-centric data |
| Composite | `user_id#order_date` | Range queries per user |
| Write sharding | `status#random_suffix` | Distribute hot keys |
| Calculated suffix | `date#hash(user_id) % N` | Time-series + distribution |

### Write Sharding Example

```python
import random

def get_sharded_key(status, shard_count=10):
    shard = random.randint(0, shard_count - 1)
    return f"{status}#{shard}"

# PK: "active#3", "active#7", "active#1" → distributed
```

- Trade-off: Cần scatter-gather khi đọc (query tất cả shards)

{{% notice warning %}}
Hot partition → throttling dù tổng capacity đủ. Adaptive capacity giúp nhưng không thay thế good key design.
{{% /notice %}}

{{% notice tip %}}
**Exam Tip:** Đề hỏi "throttling despite sufficient capacity" → hot partition → cần high-cardinality key hoặc write sharding.
{{% /notice %}}
