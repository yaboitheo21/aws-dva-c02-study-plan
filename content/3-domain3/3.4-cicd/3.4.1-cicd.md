---
title: "3.4.1-3.4.11 CodePipeline, Strategies, Rollbacks"
date: 2025-02-11
weight: 1
---

## CI/CD Pipeline

```
Source (CodeCommit/GitHub)
  → Build (CodeBuild — buildspec.yml)
    → Test (CodeBuild)
      → Manual Approval (optional)
        → Deploy (CodeDeploy/CloudFormation)
```

### CodeBuild — buildspec.yml
```yaml
version: 0.2
phases:
  install:
    runtime-versions:
      python: 3.12
  pre_build:
    commands:
      - pip install -r requirements.txt
  build:
    commands:
      - sam build
      - sam package --s3-bucket $BUCKET --output-template-file packaged.yaml
artifacts:
  files:
    - packaged.yaml
```

## Deployment Strategies

| Strategy | Downtime | Rollback | Speed |
|----------|----------|----------|-------|
| All-at-once | Possible | Redeploy | Fastest |
| Rolling | No (reduced capacity) | Manual | Medium |
| Rolling + extra batch | No | Manual | Medium |
| Immutable | No | Terminate new | Slow |
| Blue/Green | No | Switch back | Medium |
| Canary | No | Automatic | Slow |

### CodeDeploy — Lambda

| Type | Behavior |
|------|----------|
| Canary10Percent5Minutes | 10% → wait 5min → 100% |
| Canary10Percent30Minutes | 10% → wait 30min → 100% |
| Linear10PercentEvery1Minute | +10% every minute |
| AllAtOnce | 100% immediately |

### appspec.yml — Lambda
```yaml
version: 0.0
Resources:
  - MyFunction:
      Type: AWS::Lambda::Function
      Properties:
        Name: my-function
        Alias: live
        CurrentVersion: 1
        TargetVersion: 2
```

## Rollbacks
- **CodeDeploy**: Automatic on failure/alarm, manual redeploy
- **CloudFormation**: Automatic on failure, `--disable-rollback` for debug
- **Lambda**: Update alias to previous version
- **ECS**: Route traffic back to original task set

{{% notice tip %}}
**Exam Tip:** CodeDeploy hooks order (EC2): BeforeInstall → AfterInstall → ApplicationStart → ValidateService. Lambda: BeforeAllowTraffic → AfterAllowTraffic.
{{% /notice %}}
