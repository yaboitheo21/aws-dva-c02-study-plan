---
title: "2.2.1-2.2.7 KMS, Encryption, Key Rotation"
date: 2025-02-11
weight: 1
---

## S3 Encryption

| Type | Key Management | Audit Trail |
|------|---------------|-------------|
| SSE-S3 | AWS manages entirely | ❌ |
| SSE-KMS | KMS manages | ✅ CloudTrail |
| SSE-C | Customer provides key | ❌ |
| Client-side | Application manages | ❌ |

## KMS

### Envelope Encryption (data > 4KB)
1. `GenerateDataKey` → plaintext data key + encrypted data key
2. Encrypt data locally với plaintext key
3. Lưu encrypted data key + encrypted data
4. Delete plaintext key from memory
5. Decrypt: KMS decrypt encrypted data key → decrypt data

### KMS API Calls

| API | Use Case |
|-----|----------|
| `Encrypt` | Data ≤ 4KB |
| `Decrypt` | Decrypt data |
| `GenerateDataKey` | Envelope encryption |
| `GenerateDataKeyWithoutPlaintext` | Deferred encryption |

{{% notice warning %}}
KMS API có quota limits (5,500-30,000 req/s tùy region). Throttling → request quota increase hoặc dùng data key caching.
{{% /notice %}}

## Key Rotation

| | Automatic | Manual |
|---|---|---|
| Customer managed | ✅ Every year | Tạo new key, update alias |
| AWS managed | ✅ Every year (by AWS) | N/A |
| Imported keys | ❌ | Tạo new key |
| Key ID | Giữ nguyên | Thay đổi → dùng alias |

## Cross-Account Encryption
- Key policy + IAM policy (both phải allow)
- AWS managed keys (`aws/s3`, `aws/ebs`) **KHÔNG thể** share cross-account
- Phải dùng Customer Managed Keys (CMK)

{{% notice tip %}}
**Exam Tip:** SSE-KMS có API call limits. Nếu high-throughput → xem xét SSE-S3 hoặc data key caching.
{{% /notice %}}
