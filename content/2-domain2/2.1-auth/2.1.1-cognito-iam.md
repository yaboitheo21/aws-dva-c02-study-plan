---
title: "2.1.1-2.1.8 Cognito, IAM, STS"
date: 2025-02-11
weight: 1
---

## Cognito

### User Pools (Authentication — "Who are you?")
- User directory: Sign-up, sign-in, MFA
- Trả về JWT tokens: ID token, Access token, Refresh token
- Hosted UI, social providers (Google, Facebook, SAML, OIDC)
- Lambda triggers: Pre/post authentication, custom message

### Identity Pools (Authorization — "What can you do?")
- Cung cấp temporary AWS credentials
- Federation: User Pools, social providers, SAML
- Map users to IAM roles

### Typical Flow
```
User → Cognito User Pool → JWT Token → Cognito Identity Pool → AWS Credentials → AWS Services
```

## IAM

### Policy Evaluation Logic
1. Explicit Deny → **DENY** (luôn thắng)
2. SCP → Allow?
3. Resource-based policy → Allow?
4. Permission boundary → Allow?
5. Identity-based policy → Allow?
6. Default → **DENY**

### Policy Types

| Type | Gắn vào | Use Case |
|------|---------|----------|
| Identity-based | User, Group, Role | Permissions cho principal |
| Resource-based | Resource (S3, Lambda) | Cross-account access |
| Permission boundary | IAM entity | Max permissions limit |
| Session policy | STS session | Temporary restrictions |

## STS AssumeRole
- Temporary credentials: Access key + Secret key + Session token
- Duration: 15 min → 12 hours
- Cross-account access, temporary elevated permissions
- `ExternalId`: Chống confused deputy problem

## API Gateway Authorization

| Method | Use Case | Token Type |
|--------|----------|------------|
| IAM | AWS services, internal APIs | SigV4 |
| Lambda Authorizer | Custom logic, third-party tokens | Custom |
| Cognito Authorizer | User authentication | JWT |

{{% notice tip %}}
**Exam Tip:** Credential resolution order: Code → Env vars → Credentials file → Instance Profile/Task Role. LUÔN dùng IAM roles thay vì hardcoded credentials.
{{% /notice %}}
