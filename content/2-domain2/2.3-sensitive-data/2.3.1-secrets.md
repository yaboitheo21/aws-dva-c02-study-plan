---
title: "2.3.1-2.3.6 Secrets Manager, SSM, Multi-Tenant"
date: 2025-02-11
weight: 1
---

## Secrets Manager vs SSM Parameter Store

| | Secrets Manager | SSM Parameter Store |
|---|---|---|
| Rotation | ✅ Built-in (Lambda) | ❌ Manual (Lambda + EventBridge) |
| RDS integration | ✅ Auto-rotate DB passwords | ❌ |
| Pricing | Per secret + per API call | Free (Standard tier) |
| Cross-account | ✅ Resource policy | ❌ |
| Max size | 64KB | 8KB (Standard) / 8KB (Advanced) |
| Hierarchy | ❌ | ✅ `/app/dev/db-password` |

### Khi nào dùng cái nào?
- **Secrets Manager**: DB credentials cần rotation, cross-account
- **SSM Parameter Store**: Config values, feature flags, non-rotating secrets

## Lambda Environment Variables
- Mặc định encrypted at rest (AWS managed key)
- Custom encryption: KMS CMK + encryption helpers
- **Best practice**: Dùng Secrets Manager/SSM thay vì env vars cho secrets

## Data Masking
- Mask PII trong logs: `email → j***@example.com`
- Mask credit cards: `**** **** **** 1234`
- KHÔNG log passwords, tokens, API keys

## Multi-Tenant Patterns

| Pattern | Isolation | Cost |
|---------|-----------|------|
| Silo | Strong (separate resources) | High |
| Pool | Weak (shared, tenant_id) | Low |
| Bridge | Mixed | Medium |

### DynamoDB Multi-Tenant
```json
{
  "Effect": "Allow",
  "Action": ["dynamodb:GetItem", "dynamodb:PutItem"],
  "Resource": "arn:aws:dynamodb:*:*:table/Orders",
  "Condition": {
    "ForAllValues:StringEquals": {
      "dynamodb:LeadingKeys": ["${cognito-identity.amazonaws.com:sub}"]
    }
  }
}
```

{{% notice tip %}}
**Exam Tip:** `dynamodb:LeadingKeys` condition là cách phổ biến nhất cho multi-tenant DynamoDB access control.
{{% /notice %}}
